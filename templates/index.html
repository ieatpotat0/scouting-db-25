<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRC Scouting App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>
<body>
    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-box">
            <h3>Confirm Deletion</h3>
            <p id="confirm-message">Are you sure you want to delete this pick list?</p>
            <div class="modal-actions">
                <button id="confirm-yes" class="btn btn-danger">Yes, Delete</button>
                <button id="confirm-no" class="btn">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div id="context-menu" class="context-menu">
        <div class="context-menu-item" data-action="close">Close Graph</div>
    </div>

    <!-- Workspace Controls -->
        <!-- Workspace Controls -->
    <div class="workspace-controls">
        <button id="home-view-btn" class="control-btn" title="Home View">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        </button>
        <button id="auto-layout-btn" class="control-btn" title="Auto Layout">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
            </svg>
        </button>
        <button id="refresh-graphs-btn" class="control-btn" title="Refresh Graphs">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        </button>
    </div>

    <!-- Main App Container -->
    <div class="app-layout">
        <!-- Main Content Area -->
        <main class="main-area">
            <!-- DISPLAY VIEW (Main view with graphs and sidebars) -->
            <div id="display-view" class="view-base">
                <!-- Rankings Sidebar (Left) -->
                <div class="rankings-sidebar" id="rankings-sidebar">
                    <div class="rankings-header">
                        <h3>RANKINGS</h3>
                        <div class="rankings-controls">
                            <button id="add-list-btn" class="btn-icon" title="New List">+</button>
                            <button id="export-rankings-btn" class="btn-icon" title="Export">↓</button>
                            <button class="sidebar-close" data-sidebar="rankings">×</button>
                        </div>
                    </div>
                    <div class="rankings-resize-handle"></div>
                    <div class="rankings-content">
                        <div class="rankings-lists-wrapper">
                            <div class="rankings-lists" id="rankings-lists"></div>
                        </div>
                        <div class="rankings-pool">
                            <h4>Team Pool</h4>
                            <div id="rankings-team-pool"></div>
                        </div>
                    </div>
                </div>

                <!-- Rankings Toggle Button -->
                <button class="sidebar-toggle left" id="rankings-toggle">RANKINGS</button>

                 <!-- Teams Sidebar (Right) -->
                <div class="filter-sidebar" id="teams-sidebar">
                    <div class="filter-header">
                        <h3>TEAMS</h3>
                        <button class="sidebar-close" data-sidebar="teams">×</button>
                    </div>
                    <div class="filter-resize-handle"></div>
                    <div class="filter-content">
                        <h4>Team Selection</h4>
                        <div id="team-selectors"></div>
                        <button id="add-team-btn" class="btn-sm">+ Add Team</button>
                    </div>
                </div>
                
                <!-- Graphs Sidebar (Right) -->
                <div class="filter-sidebar" id="graphs-sidebar">
                    <div class="filter-header">
                        <h3>GRAPHS</h3>
                        <button class="sidebar-close" data-sidebar="graphs">×</button>
                    </div>
                    <div class="filter-resize-handle"></div>
                    <div class="filter-content">
                        <h4>Category Graphs</h4>
                        <div class="category-list">
                            <button class="category-btn" data-category="auto_coral">Auto Coral</button>
                            <button class="category-btn" data-category="autoncoral1">Auto L1</button>
                            <button class="category-btn" data-category="autoncoral2">Auto L2</button>
                            <button class="category-btn" data-category="autoncoral3">Auto L3</button>
                            <button class="category-btn" data-category="autoncoral4">Auto L4</button>
                            <button class="category-btn" data-category="tele_coral">Tele Coral</button>
                            <button class="category-btn" data-category="telecoral1">Tele L1</button>
                            <button class="category-btn" data-category="telecoral2">Tele L2</button>
                            <button class="category-btn" data-category="telecoral3">Tele L3</button>
                            <button class="category-btn" data-category="telecoral4">Tele L4</button>
                            <button class="category-btn" data-category="total_coral">Total Coral</button>
                            <button class="category-btn" data-category="net">Net</button>
                            <button class="category-btn" data-category="processor">Processor</button>
                            <button class="category-btn" data-category="climb">Climb</button>
                        </div>
                    </div>
                </div>
                
                <!-- Right Toggle Buttons -->
                <button class="sidebar-toggle right teams" id="teams-toggle">TEAMS</button>
                <button class="sidebar-toggle right graphs" id="graphs-toggle">GRAPHS</button>

                <!-- Graph Workspace -->
                <div class="graph-workspace" id="graph-workspace">
                    <div class="graph-workspace-canvas" id="graph-workspace-canvas">
                        <!-- Floating graph windows will appear here -->
                    </div>
                </div>

                <!-- Bottom Performance Graph -->
                <div class="bottom-graph" id="bottom-graph">
                    <div class="graph-resize-handle"></div>
                    <div class="bottom-graph-content">
                        <div id="bottom-graph-legend"></div>
                        <div class="bottom-graph-canvas-wrapper">
                            <canvas id="mainChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Window System for Other Views -->
            <div id="window-container">
                <!-- Windows will be created here -->
            </div>

            <!-- Taskbar -->
            <div class="taskbar">
                <div class="taskbar-nav">
                    <button class="nav-btn" data-view="upload">Upload</button>
                    <button class="nav-btn" data-view="rawdata">Raw Data</button>
                    <button class="nav-btn" data-view="team-stats">Team Stats</button>
                    <button id="minimize-all" class="nav-btn">Minimize All</button>
                    <button id="show-all" class="nav-btn">Show All</button>
                </div>
                <div class="taskbar-separator"></div>
                <div id="taskbar-items"></div>
            </div>
        </main>
    </div>

    <!-- Hidden Templates -->
        <template id="upload-template">
        <div class="window-content">
            <div class="upload-container">
                <div class="upload-card-single">
                    <h2>Upload Scouting Data</h2>
                    <p>Select .txt files or upload an entire folder containing scouting files.</p>
                    <form id="scouting-form">
                        <div class="upload-buttons">
                            <input type="file" id="scouting-input" multiple accept=".txt" style="display:none">
                            <label for="scouting-input" class="file-label">Choose Files</label>
                            
                            <input type="file" id="folder-input" webkitdirectory directory multiple style="display:none">
                            <label for="folder-input" class="file-label folder-label">Choose Folder</label>
                        </div>
                        <div id="file-list" class="file-list-scroll"></div>
                        <button type="submit" class="btn">Upload</button>
                    </form>
                    <div id="scouting-status"></div>
                </div>
            </div>
        </div>
    </template>

    <template id="rawdata-template">
        <div class="window-content">
            <div class="data-controls">
                <h2>Raw Data</h2>
                <div class="group-controls">
                    <label>Group by:</label>
                    <select id="group-by">
                        <option value="none">None</option>
                        <option value="scoutername">Scouter</option>
                        <option value="matchnum">Match</option>
                        <option value="teamnum">Team</option>
                    </select>
                    <input type="text" id="raw-search" class="input-field" placeholder="Search..." />
                </div>
            </div>
            <div class="data-table-container">
                <table id="raw-data-table">
                    <thead><tr></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </template>
    
    <template id="team-stats-template">
        <div class="stats-window-content">
            <div class="stats-header">
                <select id="stats-team-select"></select>
                <button id="stats-show-notes-btn" class="btn">Show Notes</button>
            </div>
            <div class="stats-grid" id="stats-grid"></div>
            <div class="stats-notes-view" id="stats-notes-view" style="display:none;"></div>
        </div>
    </template>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>